{% extends "base.html" %}
{% load app_tags %}

{% block title %}
  Home - Yamtrack
{% endblock title %}

{% block content %}
  <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mb-8">
    <h1 class="text-3xl font-bold text-center w-full sm:w-auto text-[#f4f4f5]">In Progress</h1>
    <div class="relative" x-data="{ open: false }">
      <button @click="open = !open"
              @click.outside="open = false"
              class="flex items-center gap-2.5 px-4 py-2.5 bg-[#18181b] hover:bg-[#27272a] rounded-xl transition-all duration-200 cursor-pointer border border-[#27272a] shadow-sm text-[#f4f4f5] focus:outline-none focus:ring-2 focus:ring-blue-500/50">
        {% include "app/icons/arrows-up-down.svg" with classes="w-4 h-4" %}
        <span class="text-sm font-medium">{{ current_sort|no_underscore|title }}</span>
        {% include "app/icons/chevron-down.svg" with classes="w-4 h-4 text-gray-400" %}
      </button>
      <div x-show="open"
           x-transition:enter="transition ease-out duration-100"
           x-transition:enter-start="transform opacity-0 scale-95"
           x-transition:enter-end="transform opacity-100 scale-100"
           x-transition:leave="transition ease-in duration-75"
           x-transition:leave-start="transform opacity-100 scale-100"
           x-transition:leave-end="transform opacity-0 scale-95"
           class="absolute right-0 mt-2.5 py-1.5 w-52 bg-[#18181b] rounded-xl shadow-xl overflow-hidden z-20 border border-[#27272a]">
        {% for value, label in sort_choices %}
          <a href="{% url 'home' %}?sort={{ value }}"
             class="block w-full px-4 py-2.5 text-left text-sm transition-all duration-200 rounded-lg mx-1 my-0.5 {% if current_sort == value %}bg-blue-600 text-white font-semibold{% else %}text-[#a1a1aa] hover:bg-[#27272a] hover:text-[#f4f4f5]{% endif %}">
            {{ label }}
          </a>
        {% endfor %}
      </div>
    </div>
  </div>
  <div class="space-y-12">
    {% for media_type, media_list in list_by_type.items %}
      <div class="bg-[#18181b]/30 p-6 rounded-3xl border border-[#27272a]">
        <h2 class="text-2xl font-bold mb-6 text-[#f4f4f5] flex items-center gap-2">
           {% icon media_type is_active=False extra_classes="w-6 h-6 text-blue-500" %}
           {{ media_type|media_type_readable_plural }}
        </h2>
        <div id="media-grid-{{ media_type }}"
             class="media-grid">
          {% include "app/components/home_grid.html" %}
        </div>

        {% if media_list.total > items_limit %}
          <div class="mt-8 flex justify-center">
            <button hx-get="{% url 'home' %}?sort={{ current_sort }}&load_media_type={{ media_type }}"
                    hx-target="#media-grid-{{ media_type }}"
                    hx-swap="beforeend"
                    hx-indicator="#loading-indicator-{{ media_type }}"
                    hx-trigger="click"
                    class="px-6 py-3 bg-blue-600 hover:bg-blue-500 text-white rounded-xl transition-all duration-200 cursor-pointer shadow-lg hover:shadow-blue-500/30 font-medium flex items-center gap-2"
                    hx-on:click="this.remove()">
                    <span>Load All ({{ media_list.total }})</span>
                    {% include "app/icons/chevron-down.svg" with classes="w-4 h-4" %}
            </button>
            <div id="loading-indicator-{{ media_type }}"
                 class="htmx-indicator text-center hidden">
              <div class="inline-flex justify-center items-center">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
              </div>
            </div>
          </div>
        {% endif %}
      </div>
    {% empty %}
      <div class="flex flex-col items-center justify-center py-32 px-4 bg-[#18181b] rounded-3xl border border-[#27272a] shadow-xl text-center">
        <div class="bg-[#27272a] rounded-full p-6 w-24 h-24 mx-auto mb-8 flex items-center justify-center border border-[#3f3f46] shadow-inner">
          {% include "app/icons/pulse.svg" with classes="w-10 h-10 text-blue-500" %}
        </div>
        <h3 class="text-2xl font-bold mb-3 text-[#f4f4f5]">No media in progress</h3>
        <p class="text-[#a1a1aa] max-w-md mb-8 text-lg">Start tracking your progress by marking items as "In Progress".</p>
        <div>
          <a href="{{ 'tv'|sample_search }}"
             class="px-8 py-3.5 bg-blue-600 text-white rounded-xl hover:bg-blue-500 transition-all duration-200 shadow-lg hover:shadow-blue-500/30 font-semibold text-lg inline-flex items-center gap-2">
             {% include "app/icons/magnifying-glass.svg" with classes="w-5 h-5" %}
             Browse Media
          </a>
        </div>
      </div>
    {% endfor %}
  </div>
{% endblock content %}
